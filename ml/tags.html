<!DOCTYPE html>
<html lang="en">

<head>
    <title>Maple Leaf &gt; Tags</title>

    <!-- Meta -->
    <meta charset="utf-8" />
    <meta name="author" content="Ben Soicher" />

    <!-- Style -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.19/css/dataTables.bootstrap4.min.css">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.19/js/dataTables.bootstrap4.min.js"></script>

</head>

<body>
    <main>
        <div class="container mb-5">
            <h1 class="h4 mt-5"><a href="../index.html">ADMPA Web Tools</a><small class="text-muted">&gt; Maple Leaf &gt; Tags</small></h1>
            <p>Analyze the tags used in the Maple Leaf feed</p>

            <table class="table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Language</th>
                        <th>Count</th>
                    </tr>
                </thead>
                <tbody id="tbody"></tbody>
            </table>

        </div>
    </main>

    <script>

        // Configure data sources
        var config = {
            json: {
                en: 'https://www.canada.ca/content/dam/dnd-mdn/documents/json/maple-en.json',
                fr: 'https://www.canada.ca/content/dam/dnd-mdn/documents/json/maple-fr.json'
            },
            search : {
                en: 'https://www.canada.ca/en/department-national-defence/maple-leaf/search.html?q=',
                fr: 'https://www.canada.ca/fr/ministere-defense-nationale/feuille-derable/recherche.html?q='
            }
        }

        // Prevent loading cached data
        $.ajaxSetup({ cache: false })

        $.when(
            $.get(config.json.en),
            $.get(config.json.fr)
        ).done(function (en, fr) {

            var json = {
                en: en[0].data,
                fr: fr[0].data
            }

            var count = {
                en: {},
                fr: {}
            }

            var html = ''

            Object.keys(json).forEach(function (lang) {

                json[lang].forEach(function (obj) {
                    obj[4].split(',').forEach(function (tag) {
                        if (tag) {
                            count[lang][tag] = count[lang][tag] ? count[lang][tag] + 1 : 1
                        }
                    })
                })

                Object.keys(count[lang]).forEach(function (key) {
                    html +='<tr><td><a href="' + config.search[lang] + key + '" target="_blank">' + key + '</td><td>' + lang + '</td><td>' + count[lang][key] + '</td></tr>'
                })

            })

            $('tbody').append(html)

            $('table').DataTable({
                "order": [[ 0, "asc" ]]
            })

        })



    </script>

</body>

</html>