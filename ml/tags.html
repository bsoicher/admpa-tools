<!DOCTYPE html>
<html lang="en">

<head>
    <title>Maple Leaf &gt; Tags</title>

    <!-- Meta -->
    <meta charset="utf-8" />
    <meta name="author" content="Ben Soicher" />

    <!-- Style -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.19/css/dataTables.bootstrap4.min.css">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.19/js/dataTables.bootstrap4.min.js"></script>

</head>

<body>
    <main>
        <div class="container mb-5">
            <h1 class="h4 mt-5"><a href="../index.html">ADMPA Web Tools</a><small class="text-muted">&gt; Maple Leaf &gt; Tags</small></h1>
            <p>Analyze the tags used in the Maple Leaf feed</p>

            <div id="filter" class="text-center">
                Show 
                <div class="btn-group mb-1" role="group">
                    <button type="button" class="btn btn-sm btn-outline-primary active" data-lang="">all</button>
                    <button type="button" class="btn btn-sm btn-outline-primary" data-lang="en">english</button>
                    <button type="button" class="btn btn-sm btn-outline-primary" data-lang="fr">french</button>
                </div>
                tags
            </div>

            <table class="table">
                <thead>
                    <tr>
                        <th width="62%" class="border-top-0">Name</th>
                        <th width="19%" class="border-top-0">Language</th>
                        <th width="19%" class="border-top-0">Count</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </main>

    <script>

        // Configure data sources
        var config = {
            json: {
                en: 'https://www.canada.ca/content/dam/dnd-mdn/documents/json/maple-en.json',
                fr: 'https://www.canada.ca/content/dam/dnd-mdn/documents/json/maple-fr.json'
            },
            search: {
                en: 'https://www.canada.ca/en/department-national-defence/maple-leaf/search.html?q=',
                fr: 'https://www.canada.ca/fr/ministere-defense-nationale/feuille-derable/recherche.html?q='
            }
        }

        // Prevent loading cached data
        $.ajaxSetup({ cache: false })

        // Datatable setup
        var table = $('table').DataTable({ order: [[0, 'asc']] })

        $.when(
            $.get(config.json.en),
            $.get(config.json.fr)
        ).done(function (en, fr) {

            var json = { en: en[0].data, fr: fr[0].data }
            var data = { en: {}, fr: {} }

            Object.keys(json).forEach(function (lang) {

                // Count occurances
                json[lang].forEach(function (obj) {
                    obj[4].split(',').forEach(function (tag) {
                        if (tag) {
                            data[lang][tag] = data[lang][tag] ? data[lang][tag] + 1 : 1
                        }
                    })
                })

                // Add to datatable
                Object.keys(data[lang]).forEach(function (tag) {
                    table.row.add([
                        '<a href="' + config.search[lang] + tag + '" target="_blank">' + tag + '</a>',
                        lang,
                        data[lang][tag]
                    ])
                })

            })

            table.draw()
        })

        // Filter table by language
        $('#filter button').click(function () {
            var $this = $(this)

            if (!$this.is('.active')) {
                $('#filter button').removeClass('active')
                var lang = $this.addClass('active').data('lang')
                table.column(1).search(lang).draw()
            }
        })

    </script>
</body>

</html>