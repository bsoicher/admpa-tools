<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="robots" content="noindex" />

    <title>CAF Mobile App Resources</title>

    <!-- Stylesheet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-timeago/1.6.7/jquery.timeago.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/utf8/3.0.0/utf8.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/downloadjs/1.4.8/download.min.js"></script>

    <style>
        .fr{display:none}
    </style>
</head>

<body>
    <main>
        <div class="container my-5">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb bg-transparent p-0 h5">
                    <li class="breadcrumb-item"><a href="../index.html">ADMPA Web Tools</a></li>
                    <li class="breadcrumb-item"><a href="../index.html">Mobile App</a></li>
                    <li class="breadcrumb-item" aria-current="page">Resources &nbsp;<span class="badge badge-warning badge-pill">In Development</span></li>
                </ol>
            </nav>
            <p>Make changes to the resources section of the mobile app.</p>
            
            <p class="mt-4 mb-0" id="published">Status: Published <abbr id="modified" class="text-primary">â€¦</abbr> by <span id="modifiedby" class="text-primary">â€¦</span></p>
            <div class="btn-group" role="group" id="language">
                <button type="button" class="btn btn-sm btn-primary" data-lang="en">English</button>
                <button type="button" class="btn btn-sm btn-outline-primary" data-lang="fr">French</button>
            </div>
            <button type="button" class="btn btn-sm btn-primary" data-lang="fr">Download</button>
            <table id="list" class="table table-sm">
                <thead>
                    <tr>
                        <th class="border-top-0">English</th>
                        <th class="border-top-0">French</th>
                        <th class="border-top-0" width="220px">Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <h2 class="h5">Instructions</h2>
            <ol class="pl-3">
                <li>Modify the listing as needed below</li>
                <li>Click download to generate and download the new JSON file</li>
                <li>Upload the file to AEM (replace existing files) in <a href="https://author-canada-prod.adobecqms.net/assets.html/content/dam/dnd-mdn/documents/json" target="_blank">/content/dam/dnd-mdn/documents/json/</a></li>
                <li>Publish the files</li>
                <li>Refresh this page to verify that the status has changed</li>
            </ol>
        </div>
    </main>

    <script>



        var asset = 'https://www.canada.ca/content/dam/dnd-mdn/documents/json/resources.json'

        // Prevent loading cached data
        $.ajaxSetup({ cache: false })

        // Display current publish status
        $.get({
            url: asset + '/_jcr_content.json',
            success: function (jcr) {
                $('#modified').text($.timeago(new Date(jcr['jcr:lastModified']))).attr('title', jcr['jcr:lastModified'])
                $('#modifiedby').text(jcr['jcr:lastModifiedBy'])
            },
            error: function () { $('#modified,#modifiedby').text('ERROR') }
        })


    

        var english = true

        $(document).on('click', '#language button', function () {
            $('#language button').toggleClass('btn-primary btn-outline-primary')

            lang = 'en'
        })

        $(document).on('click', '#fr', function() {
            if (lang !== 'fr') {
                $('#en,#fr').toggleClass('btn-primary btn-outline-primary')

                lang = 'fr'
            }
        })

        // Move a table row up
        $(document).on('click', '.move-up', function () {
            var tr = $(this).closest('tr')
            tr.insertBefore(tr.prev())
        })

        // Move a table row down
        $(document).on('click', '.move-down', function () {
            var tr = $(this).closest('tr')
            tr.insertAfter(tr.next())
        })

        // Delete table row
        $(document).on('click', '.remove', function () {
            $(this).closest('tr').toggleClass('table-danger')
        })

        $(document).on('input', 'input', function() {
            var i = $(this)
            var tr = i.closest('tr')
            
            if(i.val() === i.data('original')) {
                tr.removeClass('table-danger')
            } else {

            }

            $(this).closest('tr').addClass('table-warning')
        })

        function render(json) {

            var tree = ''

            json.sections.forEach(function(section){
                tree += '<ul>'
                tree += '<li><span class="en">' + section.title.en + '</span><span class="fr">' + section.title.fr + '</span>'
                tree += '<ul>'

                section.list.forEach(function(item) {
                    tree += '<li><span class="en">' + item.title.en + '</span><span class="fr">' + item.title.fr + '</span>'

                    if (item.web) {
                        tree += '<a class="badge badge-light en" href="' + item.web.en + '" target="_blank">ðŸ”—</a>'
                        tree += '<a class="badge badge-light fr" href="' + item.web.fr + '" target="_blank">ðŸ”—</a>'
                    }

                    if (item.phone) {
                        tree += '<abbr class="badge badge-light en" title="' + item.phone + '">ðŸ“ž</abbr>'
                    }

                    tree += '</li>'
                })

                tree += '</ul>'
                tree += '</ul>'
            })

            $('main .container').append(tree)


            var html = ''
            json.sections.forEach(function (section) {
                html += '<tr>'
                    
                html += '<td><input type="text" class="form-control border-0 rounded-0" value="' + section.title.en + '" data-original="' + section.title.en + '"/></td>'
                html += '<td><input type="text" class="form-control border-0 rounded-0" value="' + section.title.fr + '" data-original="' + section.title.en + '"/></td>'

                
                //html += '<input type="text" class="form-control border-0 rounded-0" placeholder="test" aria-label="test" aria-describedby="basic-addon2" value="' + section.title.fr + '" />'
                html += '<td class="text-right">'
                html += '<button class="btn btn-outline-primary border-0 rounded-0" type="button" title="Show Items">' + section.list.length + ' items</button>'
                html += '<button class="btn btn-outline-primary border-0 rounded-0 move-up" type="button" title="Move Up">&uarr;</button>'
                html += '<button class="btn btn-outline-primary border-0 rounded-0 move-down" type="button" title="Move Down">&darr;</button>'
                html += '<button class="btn btn-outline-primary border-0 rounded-0 remove" type="button" title="Remove">âœ•</button>'
                html += '</td>'
                html += '</tr>'

          /*
                html += '<ul>'

                section.list.forEach(function(item) {
                    html += '<li>' + item.title.en + '</li>'
                })

                html += '</ul>'
                */

               // html += '<input type="text" class="form-control" value="' + section.title.en + '"/>'
                //html += '<input type="text" class="form-control" value="' + section.title.fr + '"/></div><div class="col">Desc:'
               // html += '<input type="text" class="form-control" value="' + section.description.en + '"/>'

                //html += '<input type="text" class="form-control" value="' + section.description.fr + '"/>'


               // html += '</div></div></section>'

             
            })

          

            $('#list tbody').append(html)

        }





        jQuery.get({
            url: asset,
            cache: false
        }).done(function (data) {

            render(data)

        })

    </script>

</body>

</html>